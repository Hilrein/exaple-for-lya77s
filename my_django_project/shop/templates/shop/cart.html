{% extends "shop/base.html" %}
{% load static %}

{% block title %}–ö–æ—Ä–∑–∏–Ω–∞ - KI Group{% endblock %}

{% block content %}
<style>
  /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
  .fade-in {
    animation: fadeInUp 0.6s ease forwards;
    opacity: 0;
    transform: translateY(20px);
  }
  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–ª–∞–≤–Ω—ã–º —Ç–µ–Ω—å—é –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  .cart-item {
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    border-radius: 1rem;
  }
  .cart-item:hover {
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    transform: translateY(-5px);
  }

  /* –ö–Ω–æ–ø–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  .btn-success {
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  .btn-success:hover {
    background-color: #28a745cc;
    box-shadow: 0 0 12px #28a745cc;
  }
  .btn-outline-secondary {
    transition: color 0.3s ease, border-color 0.3s ease, background-color 0.3s ease;
  }
  .btn-outline-secondary:hover {
    background-color: #6c757d10;
    color: #6c757d;
    border-color: #6c757d;
  }

  /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ª–µ–≥–∫–æ–π —Ç–µ–Ω—å—é */
  h2.fw-bold {
    text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
  }

  /* –ò—Ç–æ–≥–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –ª–µ–≥–∫–∏–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */
  .order-summary {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
  }

  /* –°—Ç–∏–ª–∏–∑—É–µ–º –ø—É—Å—Ç—É—é –∫–æ—Ä–∑–∏–Ω—É */
  .empty-cart {
    background: #fefefe;
    border: 2px dashed #ced4da;
    transition: background-color 0.3s ease;
  }
  .empty-cart:hover {
    background-color: #f1f3f5;
  }
</style>

<div class="row mb-4 fade-in">
    <div class="col-12">
        <h2 class="fw-bold text-dark">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
    </div>
</div>

{% if cart|length > 0 %}
<div class="row gy-4 fade-in">
    <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class="col-lg-8">
        <div class="card border-0 shadow rounded-4">
            <div class="card-body p-4">
                {% for item in cart %}
                <div class="d-flex align-items-center justify-content-between border-bottom pb-3 mb-3 cart-item shadow-sm">
                    <div class="d-flex align-items-center">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" width="70" class="rounded shadow-sm me-3">
                        {% else %}
                        <img src="{% static 'img/no-image.png' %}" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" width="70" class="rounded shadow-sm me-3">
                        {% endif %}
                        <div>
                            <a href="{{ item.product.get_absolute_url }}" class="fw-semibold text-dark fs-6 text-decoration-none">{{ item.product.name }}</a><br>
                            <small class="text-muted">–¶–µ–Ω–∞: {{ item.price }} ‚Ç∏</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <p class="mb-1">–ö–æ–ª-–≤–æ: <strong>{{ item.quantity }}</strong></p>
                        <p class="mb-1">–°—É–º–º–∞: <strong>{{ item.total_price }} ‚Ç∏</strong></p>
                        <a href="{% url 'cart_remove' item.product.id %}" class="btn btn-sm btn-outline-danger rounded-pill" title="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã">
                            <i class="fa fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- –ò—Ç–æ–≥ -->
    <div class="col-lg-4">
        <div class="card border-0 shadow rounded-4 order-summary">
            <div class="card-body p-4">
                <h5 class="fw-bold mb-3">üßæ –ò—Ç–æ–≥</h5>
                <ul class="list-unstyled mb-4 fs-6">
                    <li class="d-flex justify-content-between mb-2">
                        <span>–¢–æ–≤–∞—Ä–æ–≤:</span>
                        <strong>{{ cart|length }}</strong>
                    </li>
                    <li class="d-flex justify-content-between mb-2">
                        <span>–û–±—â–∞—è —Å—É–º–º–∞:</span>
                        <strong>{{ cart.get_total_price }} ‚Ç∏</strong>
                    </li>
                </ul>
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-success rounded-pill" data-bs-toggle="modal" data-bs-target="#orderModal" aria-label="–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑">
                        –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É
                    </button>
                    <a href="{% url 'product_list' %}" class="btn btn-outline-secondary rounded-pill" aria-label="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫–∞–∑–∞ -->
<div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content rounded-4 shadow-lg border-0">
      <div class="modal-header bg-dark text-white rounded-top">
        <h5 class="modal-title" id="orderModalLabel">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <form action="{% url 'order_create' %}" method="post" class="needs-validation" novalidate>
        <div class="modal-body">
          {% csrf_token %}
          <div class="mb-3">
            <label for="{{ form.full_name.id_for_label }}" class="form-label">–§–ò–û</label>
            {{ form.full_name }}
            <div class="invalid-feedback">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û.</div>
          </div>
          <div class="mb-3">
            <label for="{{ form.phone.id_for_label }}" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            {{ form.phone }}
            <div class="invalid-feedback">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Bootstrap client-side validation
  (function () {
    'use strict'
    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>

{% else %}
<div class="row fade-in">
    <div class="col-12">
        <div class="alert alert-light empty-cart border shadow-sm text-center rounded-4 p-5">
            <h5 class="mb-3">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h5>
            <a href="{% url 'product_list' %}" class="btn btn-primary rounded-pill px-4 shadow-sm" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º</a>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
